<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo Todo</title>
    <link rel="stylesheet" href="./todo.css">
    <script src="./todo.js"></script>
</head>
<body>
    <h1>Todo Todo</h1>
    <input id="todoInput" type="text" placeholder="What needs to be done?">
    <ul id="todoList"></ul>
</body>
</html>
<script>
    /* 구현 목표
    1. input 창에 할 일을 적고 엔터치면 todo list에 추가된다 00
    2. 추가될 때: input에 쓴 내용과 앞에 checker가 같이 추가된다 00
    5. 추가된 input을 클릭하면 내용을 수정할 수 있다 00
    7. 추가된 input을 삭제할 수도 있다 00

    3. checker를 누르면 line-through되면서 completed task가 된다 00
    8. checker를 다시 누르면 completed task 마크가 사라진다 00

    4. todo task/completed task가 있고, 이 count가 바뀐다 00

    6. 전체 저장/ 전체 clear를 누르면 localStorage에 저장되어서 다음에 창을 열어도 볼 수 있다
    * */

    document.addEventListener('DOMContentLoaded', () => {
        new TodoInput();
        new Counter();
    });

    class TodoInput {
        constructor() {
            this.addTodo();
        }

        addTodo() {
            let todoInput = document.querySelector('#todoInput');

            todoInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    let todoContent = todoInput.value;
                    new TodoItem(todoContent);
                    todoInput.value = '';
                    countTodoItems();
                }
            });
        }
    }

    class TodoItem {
        constructor(todoContent) {
            this.todoCheckBox = new TodoCheckBox();
            this.todoDeleteBtn = new TodoDeleteBtn();
            this.todoContentBox = new TodoContentBox(todoContent);

            this.todoItem = this.createTodoItemDom(todoContent);
            this.todoItem.classList.add("todoItem");
            this.todoItem.classList.add("todo");

            let todoList = document.querySelector('#todoList');
            todoList.appendChild(this.todoItem);
        }

        createTodoItemDom() {
            let todoItemDom = document.createElement("li");

            todoItemDom.appendChild(this.todoCheckBox.todoCheckBoxNode);
            todoItemDom.appendChild(this.todoContentBox['todoOriginalBoxNode']);
            todoItemDom.appendChild(this.todoContentBox['todoUpdateBoxNode']);
            todoItemDom.appendChild(this.todoDeleteBtn.todoDeleteBtnNode);

            todoItemDom.addEventListener('click', (e)=> {
                let todoOriginalBox = this.todoContentBox['todoOriginalBoxNode'];
                let todoUpdateBox = this.todoContentBox['todoUpdateBoxNode'];

                if(e.target.className === 'todoItem') {
                    todoOriginalBox.classList.add('hidden');
                    todoUpdateBox.classList.remove('hidden');
                } else if(e.target.className === 'todoOriginalBox') {
                    todoOriginalBox.classList.add('hidden');
                    todoUpdateBox.classList.remove('hidden');
                }
            });

            todoItemDom.addEventListener('mouseenter', ()=> {
                this.todoDeleteBtn.todoDeleteBtnNode.classList.remove('hidden');
            });

            todoItemDom.addEventListener('mouseleave', ()=> {
                this.todoDeleteBtn.todoDeleteBtnNode.classList.add('hidden');
            });

            return todoItemDom;
        }
    }

    class TodoCheckBox {
        constructor() {
            this.todoCheckBoxNode = document.createElement("input");
            this.createTodoCheckBoxNode(this.todoCheckBoxNode);
        }

        createTodoCheckBoxNode(todoCheckBoxNode) {
            todoCheckBoxNode.classList.add("todoCheckBox");
            todoCheckBoxNode.setAttribute('type', 'checkbox');
            todoCheckBoxNode.addEventListener('click', ()=> {
                todoCheckBoxNode.parentNode.classList.toggle('completed');
                todoCheckBoxNode.parentNode.classList.toggle('todo');
                countTodoItems();
                countDoneItems();
            });
            return todoCheckBoxNode;
        }
    }

    class TodoContentBox{
        constructor(todoContent) {
            this.todoContent = todoContent;
            this.todoOriginalBoxNode = document.createElement("span");
            this.todoUpdateBoxNode = document.createElement("input");
            this.createTodoContentBoxNode(this.todoOriginalBoxNode, this.todoUpdateBoxNode);
        }

        createTodoContentBoxNode(todoOriginalBoxNode, todoUpdateBoxNode) {
            todoOriginalBoxNode.classList.add("todoOriginalBox");
            todoOriginalBoxNode.innerText = this.todoContent;
            let todoOriginalBoxValue = todoOriginalBoxNode.innerText;

            todoUpdateBoxNode.classList.add("todoUpdateBox");
            todoUpdateBoxNode.classList.add("hidden");
            todoUpdateBoxNode.setAttribute('placeholder', `${this.todoContent}`);
            todoUpdateBoxNode.setAttribute('type', 'text');

            todoUpdateBoxNode.addEventListener('keypress', (e)=> {
                let updatedValue = e.target.value;
                if(e.key === 'Enter' && updatedValue) {
                    todoOriginalBoxNode.innerText = updatedValue;
                    todoOriginalBoxValue = updatedValue;
                    todoUpdateBoxNode.setAttribute('placeholder', `${updatedValue}`);
                    todoUpdateBoxNode.value = '';
                    todoOriginalBoxNode.classList.remove('hidden');
                    todoUpdateBoxNode.classList.add('hidden');
                } else if (e.key === 'Enter' && !updatedValue) {
                    todoOriginalBoxNode.innerText = todoOriginalBoxValue;
                    todoUpdateBoxNode.setAttribute('placeholder', `${todoOriginalBoxValue}`);
                    todoOriginalBoxNode.classList.remove('hidden');
                    todoUpdateBoxNode.classList.add('hidden');
                }
            });

            return [todoOriginalBoxNode, todoUpdateBoxNode];
        }
    }

    class TodoDeleteBtn {
        constructor() {
            this.todoDeleteBtnNode = document.createElement("button");
            this.createTodoDeleteBtnNode(this.todoDeleteBtnNode);
        }

        createTodoDeleteBtnNode(todoDeleteBtnNode) {
            todoDeleteBtnNode.innerText = 'x';
            todoDeleteBtnNode.classList.add("deleteBtn");
            todoDeleteBtnNode.classList.add("hidden");
            todoDeleteBtnNode.addEventListener('click', ()=> {
                let todoList = document.querySelector('#todoList');
                todoList.removeChild(todoDeleteBtnNode.parentNode);
                countTodoItems();
                countDoneItems();
            });
            return todoDeleteBtnNode;
        }
    }

    class Counter {
        constructor() {
            this.counterNode = document.createElement("div");
            this.createTodoCountNode(this.counterNode);
        }

        createTodoCountNode(counterNode) {
            let todoCounterNode = document.createElement("span");
            todoCounterNode.innerText = 'Todo';
            let todoCounterValueNode = document.createElement("span");
            todoCounterValueNode.classList.add('todoNum');
            todoCounterValueNode.innerText = todoNum;

            let doneCountNode = document.createElement("span");
            doneCountNode.innerText = 'Done';
            let doneCountValueNode = document.createElement("span");
            doneCountValueNode.classList.add('doneNum');
            doneCountValueNode.innerText = doneNum;

            counterNode.appendChild(todoCounterNode);
            counterNode.appendChild(todoCounterValueNode);
            counterNode.appendChild(doneCountNode);
            counterNode.appendChild(doneCountValueNode);

            document.body.appendChild(counterNode);

            return counterNode;
        }
    }

    let todoNum = 0;
    let doneNum = 0;

    function countTodoItems() {
        let todoItems = document.querySelectorAll('.todo');
        todoNum = todoItems.length;

        let todoNumNode = document.querySelector('.todoNum');
        todoNumNode.innerText = todoNum;

        return todoNum;
    }

    function countDoneItems() {
        let doneItems = document.querySelectorAll('.completed');
        doneNum = doneItems.length;

        let doneNumNode = document.querySelector('.doneNum');
        doneNumNode.innerText = doneNum;

        return doneNum;
    }
</script>