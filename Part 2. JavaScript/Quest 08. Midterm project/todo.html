<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo Todo</title>
    <link rel="stylesheet" href="./todo.css">
    <script src="./todo.js"></script>
</head>
<body>
<h1>Todo Todo</h1>
<input id="todoInput" type="text" placeholder="What needs to be done?">
<ul class="todoList"></ul>
</body>
</html>
<script>
    /* 구현 목표
    1. input 창에 할 일을 적고 엔터치면 todo list에 추가된다 00
    2. 추가될 때: input에 쓴 내용과 앞에 checker가 같이 추가된다 00
    5. 추가된 input을 클릭하면 내용을 수정할 수 있다 00
    7. 추가된 input을 삭제할 수도 있다 00

    3. checker를 누르면 line-through되면서 completed task가 된다 00
    8. checker를 다시 누르면 completed task 마크가 사라진다

    4. todo task/completed task가 있고, 이 count가 바뀐다

    6. 전체 저장/ 전체 clear를 누르면 localStorage에 저장되어서 다음에 창을 열어도 볼 수 있다
    * */

    document.addEventListener('DOMContentLoaded', () => {
        new TodoInput();
    });

    let isClicked = false;

    class TodoInput {
        constructor() {
            this.addTodo();
        }

        addTodo() {
            let todoInput = document.querySelector('#todoInput');

            todoInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    let todoContent = todoInput.value;
                    new TodoItem(todoContent);
                    todoInput.value = '';
                }
            })
        }
    }

    class TodoItem {
        constructor(todoContent) {
            this.todoItem = this.getTodoItemDom(todoContent);
            this.todoItem.classList.add("todoItem");
            let todoList = document.querySelector('.todoList');
            todoList.appendChild(this.todoItem);
        }

        getTodoItemDom(todoContent) {
            let todoItem = document.createElement("li");
            let todoItemValue = document.createElement("span");
            todoItemValue.classList.add("todoItemValue");
            todoItemValue.innerText = todoContent;
            let todoItemInput = document.createElement("input");
            todoItemInput.classList.add("todoItemInput");
            todoItemInput.classList.add("hidden");
            todoItemInput.setAttribute('placeholder', `${todoContent}`);
            todoItemInput.setAttribute('type', 'text');
            let todoCheckBox = document.createElement("input");
            todoCheckBox.classList.add("todoCheckBox");
            todoCheckBox.setAttribute('type', 'checkbox');
            let deleteBtn = document.createElement("a");
            deleteBtn.innerText = 'X';
            deleteBtn.classList.add("deleteBtn");
            deleteBtn.classList.add("hidden");

            todoItem.appendChild(todoCheckBox);
            todoItem.appendChild(todoItemValue);
            todoItem.appendChild(todoItemInput);
            todoItem.appendChild(deleteBtn);

            todoItem.addEventListener('click', (e)=> {
                if(e.target.className === 'todoItem') {
                    // li 태그일때
                    this.updateTodoItem(e.target);
                } else if(e.target.className === 'todoItemValue') {
                    // 안에 span일 때
                    this.updateTodoItem(e.target.parentNode);
                } else if(e.target.className === 'todoCheckBox') {
                    // checkbox일 때
                    e.target.classList.add('checked');
                    new TodoCheckBox();
                }
            });
            todoItem.addEventListener('mouseover', (e)=> {
                if(e.target.className === 'todoItem') {
                    // li태그일때
                    this.deleteTodoItem(e.target);
                } else if(e.target.className === 'todoItemValue') {
                    // span 안에 span일 때
                    this.deleteTodoItem(e.target.parentNode);
                }
            });

            return todoItem;
        }


        updateTodoItem(target) {
            target.classList.add('updating');

            let spanTodo = document.querySelector('.updating .todoItemValue');
            spanTodo.classList.add('hidden');
            let inputTodo = document.querySelector('.updating .todoItemInput');
            inputTodo.classList.remove('hidden');
            inputTodo.addEventListener('keypress', (e)=> {
                if(e.key === 'Enter') {
                    spanTodo.innerText = inputTodo.value;
                    spanTodo.classList.remove('hidden');
                    inputTodo.classList.add('hidden');
                }
            });

            target.classList.remove('updating');
        }

        deleteTodoItem(target) {
            target.classList.add('deleting');

            let deleteBtn = document.querySelector('.deleting .deleteBtn');
            deleteBtn.classList.remove('hidden');

            deleteBtn.addEventListener('click', ()=> {
                let todoList = document.querySelector('.todoList');
                todoList.removeChild(target);
            });

            target.classList.remove('deleting');
        }
    }

    class TodoCheckBox {
        constructor() {
            this.changeTodoItemState();
        }

        changeTodoItemState() {
            let todoCheckBox = document.querySelector('.checked');
            let checkedItem = todoCheckBox.parentNode;

            checkedItem.classList.toggle('completed');
            //
            // let isCompleted = checkedItem.classList.contains('completed');
            // if(todoCheckBox) {
            //     checkedItem.classList.add('completed');
            //     todoCheckBox.classList.remove('checked');
            //     isCompleted = isCompleted;
            // } else if(isCompleted && !todoCheckBox) {
            //     checkedItem.classList.remove('completed');
            // }
        }
    }

    class TodoCount {
        constructor() {

        }

    }

</script>